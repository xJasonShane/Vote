import{j as e}from"./jsx-runtime.CyXy1Ci3.js";import{R as w,r as l}from"./index.CaZlGE7t.js";import{g as N}from"./helpers.CnSBAKOu.js";const j={TOPICS:"vote_rating_topics"},p={},C=300*1e3,S=()=>{try{return typeof localStorage<"u"}catch{return!1}},E=s=>s?Date.now()-s.timestamp<C:!1,T=(s,t=!1)=>{const n=p[s];if(!t&&E(n))return n.data;if(!S())return null;try{const r=localStorage.getItem(s),i=r?JSON.parse(r):null;return p[s]={data:i,timestamp:Date.now()},i}catch(r){return console.error("Error getting storage data:",r),null}},D=(s,t)=>{if(!S())return!1;try{return localStorage.setItem(s,JSON.stringify(t)),p[s]={data:t,timestamp:Date.now()},!0}catch(n){return console.error("Error setting storage data:",n),!1}},I=()=>T(j.TOPICS)||[],O=s=>{const t=I(),n=new Date,r={...s,id:N(),createdAt:n,updatedAt:n,contentItems:[],ratings:[],comments:[]},i=[...t,r];return D(j.TOPICS,i),r};function _(){const s=()=>{if(typeof window>"u")return null;const a=localStorage.getItem("vote_rating_current_user");return a?JSON.parse(a):null},[t,n]=l.useState({title:"",description:"",creator:"",tags:""}),[r,i]=l.useState({}),[g,f]=l.useState(!1),[b,u]=l.useState(null),m=l.useCallback(a=>{const{name:o,value:d}=a.target;n(c=>({...c,[o]:d})),i(c=>{const y={...c};return delete y[o],y}),u(null)},[]),x=l.useCallback(()=>{const a={},o=s();return t.title.trim()||(a.title="标题不能为空"),t.description.trim()||(a.description="描述不能为空"),o?(i(a),Object.keys(a).length===0):(u("请先登录再创建话题"),!1)},[t]),v=l.useCallback(a=>{if(a.preventDefault(),!!x()){f(!0),u(null);try{const o=s();if(!o)throw new Error("请先登录再创建话题");const d=t.tags.split(",").map(c=>c.trim()).filter(c=>c!=="");O({title:t.title,description:t.description,creator:o.username,tags:d}),window.location.href="/topics"}catch(o){const d=o instanceof Error?o.message:"创建话题失败，请稍后重试";u(d),console.error("创建话题失败:",o)}finally{f(!1)}}},[t,x]),h=s();return e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[b&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded-md mb-4",children:b}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"话题标题 *"}),e.jsx("input",{type:"text",id:"title",name:"title",value:t.title,onChange:m,className:`w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.title?"border-red-500":"border-gray-300"}`,placeholder:"请输入话题标题",required:!0,"aria-required":"true","aria-invalid":!!r.title,"aria-describedby":r.title?"title-error":void 0}),r.title&&e.jsx("p",{id:"title-error",className:"mt-1 text-sm text-red-500",children:r.title})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"话题描述 *"}),e.jsx("textarea",{id:"description",name:"description",value:t.description,onChange:m,rows:4,className:`w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.description?"border-red-500":"border-gray-300"}`,placeholder:"请输入话题描述",required:!0,"aria-required":"true","aria-invalid":!!r.description,"aria-describedby":r.description?"description-error":void 0}),r.description&&e.jsx("p",{id:"description-error",className:"mt-1 text-sm text-red-500",children:r.description})]}),h&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["当前用户：",e.jsx("span",{className:"font-medium",children:h.username})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"标签（用逗号分隔，可选）"}),e.jsx("input",{type:"text",id:"tags",name:"tags",value:t.tags,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"例如：电影,科幻,评分","aria-describedby":"tags-hint"}),e.jsx("p",{id:"tags-hint",className:"mt-1 text-xs text-gray-500",children:"多个标签之间用逗号分隔"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t border-gray-200",children:[e.jsx("a",{href:"/topics",className:"px-6 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2","aria-label":"取消创建话题",children:"取消"}),e.jsx("button",{type:"submit",disabled:g,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":"创建话题",children:g?"创建中...":"创建话题"})]})]})}const U=w.memo(_);export{U as default};
